####################################################################
########### Common installers / game conf generated by rocket######

update.game.url = "http://dl.ak.ankama.com/updates/uc1"
update.game.id  = "wakfu"
update.game.dir = PWD

game_name = "Wakfu"

update.game.options *= "main_project"


i18n.available_langs = [
    "en",
    "fr",
    "es",
    "pt",
    "de",
]

update.transition.components *= "wakfu_plugins"
update.transition.components *= "fonts"


editor.copyright = "(c) Ankama Studio 2015"

eula.licenses = {
            "fr" : [
                "${PWD}/updater_data/eulas/eula_fr.html",
            ],
            "en" : [
                "${PWD}/updater_data/eulas/eula_en.html",
            ],
            "zh" : [
                "${PWD}/updater_data/eulas/eula_en.html",
            ],
            "pt" : [
                "${PWD}/updater_data/eulas/eula_pt.html",
            ],
            "de" : [
                "${PWD}/updater_data/eulas/eula_de.html",
            ],
            "es" : [
                "${PWD}/updater_data/eulas/eula_es.html",
            ],
}

ui.links.website = {
    "fr" : "http://www.wakfu.com/fr/mmorpg",
    "en" : "http://www.wakfu.com/en/mmorpg",
    "zh" : "http://www.wakfu.cn",
    "pt" : "http://www.wakfu.com/pt/mmorpg",
    "zh-TW" : "http://www.wakfu.com.tw",
    "de" : "http://www.wakfu.com/de/mmorpg",
    "es" : "http://www.wakfu.com/es/mmorpg",
}

ui.links.support = {
    "fr" : "https://support.ankama.com/hc/fr#wakfu",
    "en" : "http://support.ankama.com/hc/en-us#wakfu",
    "zh" : "http://cs.wakfu.cn",
    "pt" : "https://support.ankama.com/hc/pt-br#wakfu",
    "zh-TW" : "http://cs.wakfu.com.tw",
    "de" : "http://support.ankama.com/hc/de#wakfu",
    "es" : "http://support.ankama.com/hc/es#wakfu",
}

ui.links.changelog = {
    "fr" : "http://www.wakfu.com/fr/mmorpg/communaute/patchs",
    "en" : "http://www.wakfu.com/en/mmorpg/community/patchs",
    "zh" : "http://changelog.wakfu.cn",
    "pt" : "http://www.wakfu.com/pt/mmorpg/noticias/patchnote",
    "zh-TW" : "http://changelog.wakfu.com.tw",
    "de" : "http://www.wakfu.com/de/mmorpg/spielergemeinde/patchs",
    "es" : "http://www.wakfu.com/es/mmorpg/comunidad/patchs",
}

ui.links.updater_support = {
    "fr" : "https://support.ankama.com/hc/fr/sections/200371823",
    "en" : "https://support.ankama.com/hc/en-us/sections/200371823",
    "zh" : "http://cs.wakfu.cn",
    "pt" : "https://support.ankama.com/hc/pt-br/sections/200371823",
    "zh-TW" : "http://cs.wakfu.com.tw",
    "de" : "https://support.ankama.com/hc/de/sections/200371823",
    "es" : "https://support.ankama.com/hc/es/sections/200371823",
}

ui.links.account_creation = {
    "fr" : "https://secure.wakfu.com/fr/mmorpg/jouer",
    "en" : "https://secure.wakfu.com/en/mmorpg/play",
    "zh" : "http://passport.wakfu.cn/signup",
    "pt" : "https://secure.wakfu.com/pt/mmorpg/play",
    "zh-TW" : "passport.wakfu.com.tw/signup",
    "de" : "https://secure.wakfu.com/de/mmorpg/play",
    "es" : "https://secure.wakfu.com/es/mmorpg/play",
}

ui.links.account_profil = {
    "fr" : "https://account.ankama.com/fr/votre-compte/profil",
    "en" : "https://account.ankama.com/en/your-account/profile",
    "pt" : "https://account.ankama.com/pt/sua-conta/perfil",
    "de" : "https://account.ankama.com/de/mein-account/profil",
    "it" : "https://account.ankama.com/it/il-tuo-account/profilo",
    "es" : "https://account.ankama.com/es/su-cuenta/perfil",
}

ui.links.account_password_forgotten = {
    "fr" : "https://account.ankama.com/fr/votre-compte/retrouver-mot-de-passe",
    "en" : "https://account.ankama.com/en/your-account/recover-your-password",
    "pt" : "https://account.ankama.com/pt/sua-conta/recupere-sua-senha",
    "de" : "https://account.ankama.com/de/mein-account/passwort-vergessen",
    "it" : "https://account.ankama.com/it/il-tuo-account/recupera-password",
    "es" : "https://account.ankama.com/es/su-cuenta/recuperar-la-contrasena",
}

ui.links.account_security_settings = {
    "fr" : "https://account.ankama.com/fr/votre-compte/securite",
    "en" : "https://account.ankama.com/en/your-account/security",
    "pt" : "https://account.ankama.com/pt/sua-conta/security",
    "de" : "https://account.ankama.com/de/mein-account/security",
    "it" : "https://account.ankama.com/it/il-tuo-account/security",
    "es" : "https://account.ankama.com/es/su-cuenta/security",
}



if equals(sys.osname, "windows") and BOOTSTRAP {
    ui.icon = "${BOOTSTRAP}@3"
    ui.game_icon = "${BOOTSTRAP}@2"
}
else {
    ui.icon = [
    "${PWD}/updater_data/icons/updater_icon_16x16.png",
    "${PWD}/updater_data/icons/updater_icon_24x24.png",
    "${PWD}/updater_data/icons/updater_icon_32x32.png",
    "${PWD}/updater_data/icons/updater_icon_48x48.png",
    "${PWD}/updater_data/icons/updater_icon_64x64.png",
    "${PWD}/updater_data/icons/updater_icon_128x128.png",
    "${PWD}/updater_data/icons/updater_icon_256x256.png",
    "${PWD}/updater_data/icons/updater_icon_512x512.png",
    ]

    ui.game_icon = [
    "${PWD}/updater_data/icons/game_icon_16x16.png",
    "${PWD}/updater_data/icons/game_icon_24x24.png",
    "${PWD}/updater_data/icons/game_icon_32x32.png",
    "${PWD}/updater_data/icons/game_icon_48x48.png",
    "${PWD}/updater_data/icons/game_icon_64x64.png",
    "${PWD}/updater_data/icons/game_icon_128x128.png",
    "${PWD}/updater_data/icons/game_icon_256x256.png",
    "${PWD}/updater_data/icons/game_icon_512x512.png",
    ]
}


ankama_account.haapi_url = "https://haapi.ankama.com/json/Ankama/v1"

if BOOTSTRAP
    application_path = BOOTSTRAP
else if equals(sys.osname, "macosx") {
    application_path = "${root}/Updater ${GAME_NAME}.app"
}
####################################################################

### Prepare

if has_function("gte") {
    if has_function("compare_versions") {
        if gte(compare_versions(UPDATER_VERSION, "3.8"), 0) {
            UPDATER_VERSION_GT_3_8 = true
        }
        if gte(compare_versions(UPDATER_VERSION, "3.9"), 0) {
            UPDATER_VERSION_GT_3_9 = true
        }
        if gte(compare_versions(UPDATER_VERSION, "3.9.1"), 0) {
            UPDATER_VERSION_GT_3_9_1 = true
        }
    }
}




### Global Options

set_application_name(game_name)
data_dir = data_location()
if !contains(data_dir, "Ankama/${game_name}")
    data_dir = "${data_dir}/${game_name}"
	

if same_paths(data_dir, root) or _SETUP.SELF_CONTAINED
    data_dir = "${root}/user_data"

game_datadir = "${data_dir}/game"

if equals(sys.osname, "linux") {
    if equals(install_in_home, true)
        update.game.dir = "${HOME}/Ankama/${update.game.id}/game"
    else
        update.game.dir = "${root}/game/"
}
else if equals(sys.osname, "windows") {
    application_path = "${root}/Wakfu.exe"
    update.game.dir = "${root}/game"
}

else if equals(sys.osname, "mac") {
    update.game.dir = "${root}/Wakfu.app/Contents/Resources"
}

update.game.url = "http://dl.ak.ankama.com/updates/uc1"
update.game.options = ["main_project"]
update.game.update_on_settings_changed *= "launcher.java.force_embedded_version"
update.game.update_on_settings_changed *= "i18n.lang"
update.game.update_on_settings_changed *= "i18n.country"
update.game.required_groups = ["base", "tutorial"]
update.game.locking_processes *= "(${game_name})#*java*##--install-folder##${update.game.dir}"

if equals(sys.osname, "linux")
    ui.icon = ":/theme/wakfu/updater_icon_64.png"
else
    ui.icon = ":/theme/wakfu/updater.ico"

ui.carousel.default = """ {
    "items": [
        { "image":{ "source": "::/theme/wakfu/default_background.png" } , "type": "image"}
    ]
}
"""

if equals (null, plugins.disable)
    plugins.disable = []
plugins.disable *= "dofusinterface"
plugins.disable *= "dofusgamelauncher"

update.transition.components *= "wakfu_plugins"
launcher.forward_output = true


### Java Launcher Options

launcher.wd = update.game.dir
launcher.java.entry = "com.ankamagames.wakfu.client.WakfuClient"

launcher.java.classpath = ["${launcher.wd}/core.jar"]
launcher.java.classpath_dirs = ["${launcher.wd}/lib"]

if equals(sys.osname, "windows")
    launcher.java.library_path  = [ "natives/win32/${launcher.java.arch}" ]
else if equals(sys.osname, "mac")
    launcher.java.library_path  = [ "natives/macosx/universal" ]
else
    launcher.java.library_path  = [ "natives/${sys.osname}/${launcher.java.arch}" ]

launcher.options = [
    "-L", "${i18n.lang}",
    "-C", "${i18n.country}",
    "-n", "${data_dir}/carousel",
    "-p", "${game_datadir}",
    "--install-folder", "${update.game.dir}",
]

if equals (UPDATER_VERSION_GT_3_8, true) {
    launcher.options += "--updater-service-port"
    launcher.options += "${service_port}"
}

# Warning: Options not supported by the selected JVM will be drop
launcher.java.options = [
    "-XX:+IgnoreUnrecognizedVMOptions",
    "-XX:MaxDirectMemorySize=92m",
    "-XX:PermSize=64m",
    "-XX:MaxPermSize=128m",
    "-XX:+UseConcMarkSweepGC##-XX:+CMSIncrementalMode",
    "-XX:MaxGCPauseMillis=30",
    "-XX:MaxTenuringThreshold=0",
    "-XX:+UseTLAB",
    "-XX:+DoEscapeAnalysis",
    "-Dsun.awt.noerasebackground=true",
    "-Dsun.java2d.noddraw=true",
    "-Djava.net.preferIPv4Stack=true",
]

java_xmx = 335544320  # 320m
java_xms = 104857600  # 100m
if equals(UPDATER_VERSION_GT_3_9, true) {
    if has_function("to_int") {
        if gt(WAKFU_TOTAL_SYSTEM_MEMORY, 1073741824) { # > 1024m
            java_xmx = to_int(min(536870912, mul(0.5, WAKFU_TOTAL_SYSTEM_MEMORY))) #take 0.5 of the RAM, never more than about 512m
            java_xms = to_int(min(335544320, mul(java_xmx, 0.33))) # xmx /3, never more than 320m
        }
    }
}

if equals(UPDATER_VERSION_GT_3_9, true)
    print("WAKFU_TOTAL_SYSTEM_MEMORY: ${WAKFU_TOTAL_SYSTEM_MEMORY}; WAKFU_FREE_SYSTEM_MEMORY: ${WAKFU_FREE_SYSTEM_MEMORY}; XMS:${java_xms}; XMX: ${java_xmx}")

launcher.java.options *= "-Xmx${java_xmx}##-Xms${java_xms}"

if equals(launcher.java.arch, "amd64") {
    launcher.java.options *= "-XX:+UseCompressedOops"
    launcher.java.options *= "-d64"
} else {
    launcher.java.options *= "-d32"
}

if equals(sys.osname, "mac") {
    launcher.java.options *= "-Xdock:name=${game_name}"
}




### Version Specifics


# Available languages according to version target

i18n.available_langs = ["fr", "en", "es", "de", "pt"]

if equals(partner, "bigpoint") {
    i18n.available_langs = ["de"]
}
else if equals(update.game.id, "wakfu-beta") {
	i18n.available_langs = ["fr", "en", "es", "de", "pt", "zh"]
}
else if equals(update.game.id, "wakfu-demo") {
	i18n.available_langs = ["fr", "en", "es", "de", "pt"]
}

if equals(i18n.lang, "fr") {
    ui.carousel.sources = ["http://www.wakfu.com/fr/mmorpg/carousel.json"]
    ui.community_menu = [
        {txt:"Notes de mise à jour", url:"http://www.wakfu.com/fr/mmorpg/communaute/patchs"},
        {txt:"Site de la communauté", url:"http://www.wakfu.com/fr/mmorpg"},
        {txt:"Forum", url:"http://www.wakfu.com/fr/forum"},
        {txt:"Encyclopédie", url:"http://www.wakfu.com/fr/mmorpg/encyclopedie"},
        {txt:"Gestion de compte", url:"https://account.ankama.com/fr/votre-compte/profil"},
        {txt:"Support", url:"https://support.ankama.com/hc/fr#wakfu"}
    ]
}
else if equals(i18n.lang, "de") {
    ui.carousel.sources = ["http://www.wakfu.com/de/mmorpg/carousel.json"]
    ui.community_menu = [
        {txt:"Changelogs", url:"http://www.wakfu.com/de/mmorpg/spielergemeinde/patchs"},
        {txt:"WAKFU-Webseite", url:"http://www.wakfu.com/de/mmorpg"},
        {txt:"Forum", url:"http://forum.wakfu.com/de"},
        {txt:"Accountverwaltung", url:"https://account.ankama.com/de/mein-account/profil"},
        {txt:"Support", url:"http://support.ankama.com/hc/de#wakfu"}
    ]
}
else if equals(i18n.lang, "es") {
    ui.carousel.sources = ["http://www.wakfu.com/es/mmorpg/carousel.json"]
    ui.community_menu = [
        {txt:"Changelogs", url:"http://www.wakfu.com/es/mmorpg/comunidad/patchs"},
        {txt:"Enciclopedia", url:"http://www.wakfu.com/es/mmorpg/enciclopedia"},
        {txt:"Paginá de la comunidad", url:"http://www.wakfu.com/es/mmorpg"},
        {txt:"Foros", url:"http://www.wakfu.com/es/forum/4-wakfu-mmorpg"},
        {txt:"Gestión de cuenta", url:"https://account.ankama.com/es/su-cuenta/perfil"},
        {txt:"Soporte ", url:"http://support.ankama.com/hc/es#wakfu"}
    ]
}
else if equals(i18n.lang, "pt") {
    ui.carousel.sources = ["http://www.wakfu.com/pt/mmorpg/carousel.json"]
    ui.community_menu = [
        {txt:"Modificações das atualizações", url:"http://www.wakfu.com/pt/mmorpg/noticias/patchnote"},
        {txt:"Site da Comunidade", url:"http://www.wakfu.com/pt"},
        {txt:"Fórum", url:"http://forum.wakfu.com/pt"},
        {txt:"Gestão de conta", url:"https://account.ankama.com/pt/sua-conta/perfil"},
        {txt:"Suporte", url:"https://support.ankama.com/hc/pt-br#wakfu"},
        {txt:"Enciclopedia", url:"http://www.wakfu.com/pt/mmorpg/enciclopedia"},
    ]
}
else {
    ui.carousel.sources = ["http://www.wakfu.com/en/mmorpg/carousel.json"]
    ui.community_menu = [
        {txt:"Changelogs", url:"http://www.wakfu.com/en/mmorpg/community/patchs"},
        {txt:"Homepage", url:"http://www.wakfu.com/en/mmorpg"},
        {txt:"Forum", url:"http://www.wakfu.com/en/forum"},
        {txt:"Game Guide", url:"http://www.wakfu.com/en/mmorpg/game-guide"},
        {txt:"Account Management", url:"https://account.ankama.com/en/your-account/profile"},
        {txt:"Support", url:"http://support.ankama.com/hc/en-us#wakfu"}
    ]
}

if equals(partner, "bigpoint") {
    if equals(i18n.lang, "de") {
		ui.carousel.sources = ["http://www.wakfu.com/de/mmorpg/carousel.json"]
		ui.community_menu = [
			{txt:"Changelogs", url: "http://www.wakfu.com/de/mmorpg/aktuelles/patchnote"},
			{txt:"WAKFU-Webseite", url:"http://www.wakfu.com/de/mmorpg"},
			{txt:"Forum", url:"http://forum.wakfu.com/de"},
			{txt:"Accountverwaltung", url:"https://api.bigpoint.com/ui/accountcenter/welcome/"},
			{txt:"Support", url:"https://api.bigpoint.com/ui/account/support/?client_id=wakfu&lang=de-DE"}
		]
		ui.links.website.de = "http://www.wakfu.com/de/mmorpg"
		ui.links.support.de = "https://api.bigpoint.com/ui/account/support/?client_id=wakfu&lang=de-DE"
		ui.links.changelog.de = "http://www.wakfu.com/de/mmorpg/aktuelles/patchnote"
		ui.links.updater_support.de = "https://api.bigpoint.com/ui/account/support/?client_id=wakfu&lang=de-DE"
	}
}


if equals(target, "steam") {
    partner = "steam"

	i18n.available_langs = ["fr", "en", "es", "de", "pt"]

    ui.carousel.sources = []
    ui.community_menu = [
        {txt:"Steam Community", url:"http://steamcommunity.com/app/215080"}
    ]

    launcher.max_number_of_instances = 1
    launcher.send_focus_request_on_clients_limit_reached = false

    plugins.disable *= "eula"
}

# If there is a defined partner, add it on command line
if !equals(partner, "") {
	launcher.options += "--partner"
	launcher.options += "${partner}"
}



